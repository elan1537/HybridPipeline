<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>Hybrid Pipeline</title>
    <style>
      body {
        margin: 0;
        padding: 0;
        overflow: hidden;
        background: #000;
        font-family: monospace;
        cursor: auto;
        transition: cursor 0.3s ease;
      }

      canvas {
        display: block;
        position: fixed;
        top: 0;
        left: 0;
        z-index: 1;
      }

      #fps-overlay {
        user-select: none;
        -webkit-user-select: none;
        -moz-user-select: none;
        -ms-user-select: none;
      }

      input,
      select,
      button {
        font-family: monospace;
        font-size: 12px;
      }

      input[type='radio'],
      input[type='checkbox'] {
        margin-right: 4px;
      }

      select option {
        background: #333;
        color: #00ff00;
      }
    </style>
  </head>
  <body>
    <script type="module" src="./src/main.ts"></script>
    <div
      id="fps-overlay"
      style="
        position: fixed;
        top: 0;
        left: 0;
        background: rgba(0, 0, 0, 0.7);
        color: #00ff00;
        padding: 12px;
        font-family: monospace;
        font-size: 14px;
        line-height: 1.2;
        z-index: 1000;
        display: flex;
        flex-direction: column;
        gap: 4px;
        border-radius: 0 0 8px 0;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.5);
        transition: opacity 0.3s ease-in-out;
        max-height: 90vh;
        overflow-y: auto;
        min-width: 250px;
      "
    >
      <div id="decode-fps">Decode FPS: --</div>
      <div id="render-fps">Render FPS: --</div>
      <div id="jpeg-fallback-option">
        <input type="checkbox" id="jpeg-fallback-checkbox" />
        <label for="jpeg-fallback-checkbox">JPEG Fallback</label>
      </div>
      <div id="ws-state-console">
        <div id="ws-state-console-text">WS State: --</div>
        <input type="button" id="ws-connect-button" value="Connect" />
        <input type="button" id="ws-disconnect-button" value="Disconnect" />
      </div>

      <!-- 레이턴시 표시 섹션 -->
      <div
        id="latency-display"
        style="margin-top: 8px; padding-top: 8px; border-top: 1px solid #333"
      >
        <div style="color: #ffff00; font-weight: bold; margin-bottom: 4px">Latency (ms)</div>
        <div id="total-latency">Total: --</div>
        <div id="network-latency">Network: --</div>
        <div id="server-latency">Server: --</div>
        <div id="decode-latency">Client: --</div>
        <div id="clock-offset" style="margin-top: 4px; color: #aaaaaa; font-size: 12px">
          Clock offset: --
        </div>
      </div>

      <!-- 해상도 정보 섹션 -->
      <div
        id="resolution-info-section"
        style="margin-top: 8px; padding-top: 8px; border-top: 1px solid #333"
      >
        <div style="color: #ffff00; font-weight: bold; margin-bottom: 4px">Resolution Info</div>
        <div id="window-size-display" style="color: #aaaaaa; font-size: 11px; margin-top: 2px">
          Window: --
        </div>
      </div>

      <!-- 렌더 모드 선택 섹션 -->
      <div
        id="render-mode-section"
        style="margin-top: 8px; padding-top: 8px; border-top: 1px solid #333"
      >
        <div style="color: #ffff00; font-weight: bold; margin-bottom: 4px">Render Mode</div>
        <div style="display: flex; flex-direction: column; gap: 2px">
          <label style="font-size: 12px; color: #00ff00">
            <input type="radio" id="fusion-mode" name="render-mode" value="fusion" checked />
            Fusion
          </label>
          <label style="font-size: 12px; color: #00ff00">
            <input type="radio" id="gaussian-only-mode" name="render-mode" value="gaussian" />
            Gaussian Only
          </label>
          <label style="font-size: 12px; color: #00ff00">
            <input type="radio" id="local-only-mode" name="render-mode" value="local" />
            Local Only
          </label>
          <label style="font-size: 12px; color: #00ff00">
            <input type="radio" id="depth-fusion-mode" name="render-mode" value="depth-fusion" />
            Depth Fusion
          </label>
        </div>
      </div>

      <!-- 디버그 옵션 섹션 -->
      <div id="debug-section" style="margin-top: 8px; padding-top: 8px; border-top: 1px solid #333">
        <div style="color: #ffff00; font-weight: bold; margin-bottom: 4px">Debug Options</div>
        <label style="font-size: 12px; color: #00ff00; display: block; margin-bottom: 2px;">
          <input type="checkbox" id="depth-debug-checkbox" />
          Depth Debug
        </label>
        <label style="font-size: 12px; color: #00ff00; display: block;">
          <input type="checkbox" id="console-debug-checkbox" />
          Show Console Debug
        </label>
        <label style="font-size: 12px; color: #00ff00; display: block;">
          <input type="checkbox" id="camera-debug-checkbox" />
          Show Camera Info
        </label>
      </div>

      <!-- 카메라 정보 표시 섹션 -->
      <div
        id="camera-info-section"
        style="margin-top: 8px; padding-top: 8px; border-top: 1px solid #333; display: none;"
      >
        <div style="color: #ffff00; font-weight: bold; margin-bottom: 4px">Camera Info</div>
        <div id="camera-position" style="color: #aaaaaa; font-size: 11px; margin-bottom: 2px;">
          Position: --
        </div>
        <div id="camera-target" style="color: #aaaaaa; font-size: 11px;">
          Target: --
        </div>
        <div style="margin-top: 4px; display: flex; gap: 4px;">
          <input 
            type="button" 
            id="save-camera-button" 
            value="Save Position" 
            style="
              background: #333;
              color: #00ff00;
              border: 1px solid #555;
              padding: 2px 6px;
              font-family: monospace;
              font-size: 10px;
              cursor: pointer;
            "
          />
          <input 
            type="button" 
            id="load-camera-button" 
            value="Load Position" 
            style="
              background: #333;
              color: #00ff00;
              border: 1px solid #555;
              padding: 2px 6px;
              font-family: monospace;
              font-size: 10px;
              cursor: pointer;
            "
          />
        </div>
        <div style="margin-top: 8px; padding-top: 8px; border-top: 1px solid #555;">
          <div style="color: #ffff00; font-weight: bold; margin-bottom: 4px; font-size: 11px;">Manual Control</div>
          <div style="display: grid; grid-template-columns: auto 1fr; gap: 2px 4px; font-size: 10px;">
            <label style="color: #aaaaaa;">Pos X:</label>
            <input type="number" id="camera-pos-x" step="0.001" style="background: #222; color: #00ff00; border: 1px solid #444; padding: 1px 3px; font-family: monospace; font-size: 10px; width: 60px;" />
            <label style="color: #aaaaaa;">Pos Y:</label>
            <input type="number" id="camera-pos-y" step="0.001" style="background: #222; color: #00ff00; border: 1px solid #444; padding: 1px 3px; font-family: monospace; font-size: 10px; width: 60px;" />
            <label style="color: #aaaaaa;">Pos Z:</label>
            <input type="number" id="camera-pos-z" step="0.001" style="background: #222; color: #00ff00; border: 1px solid #444; padding: 1px 3px; font-family: monospace; font-size: 10px; width: 60px;" />
            <label style="color: #aaaaaa;">Tar X:</label>
            <input type="number" id="camera-tar-x" step="0.001" style="background: #222; color: #00ff00; border: 1px solid #444; padding: 1px 3px; font-family: monospace; font-size: 10px; width: 60px;" />
            <label style="color: #aaaaaa;">Tar Y:</label>
            <input type="number" id="camera-tar-y" step="0.001" style="background: #222; color: #00ff00; border: 1px solid #444; padding: 1px 3px; font-family: monospace; font-size: 10px; width: 60px;" />
            <label style="color: #aaaaaa;">Tar Z:</label>
            <input type="number" id="camera-tar-z" step="0.001" style="background: #222; color: #00ff00; border: 1px solid #444; padding: 1px 3px; font-family: monospace; font-size: 10px; width: 60px;" />
          </div>
          <div style="margin-top: 4px; text-align: center;">
            <input 
              type="button" 
              id="apply-camera-button" 
              value="Apply" 
              style="
                background: #333;
                color: #00ff00;
                border: 1px solid #555;
                padding: 2px 8px;
                font-family: monospace;
                font-size: 10px;
                cursor: pointer;
              "
            />
          </div>
          <div style="color: #666; font-size: 9px; margin-top: 4px; line-height: 1.2;">
            Keyboard: WASD+QE (Position), IJKL+UO (Target)<br/>
            Hold Shift for fine control (0.01x)
          </div>
        </div>
      </div>

      <!-- FPS 측정 도구 섹션 -->
      <div id="fps-measurement-section" style="margin-top: 8px; padding-top: 8px; border-top: 1px solid #333">
        <div style="color: #ffff00; font-weight: bold; margin-bottom: 4px">Performance Test</div>
        <input 
          type="button" 
          id="fps-measurement-button" 
          value="Start FPS Test (60s)" 
          style="
            background: #333;
            color: #00ff00;
            border: 1px solid #555;
            padding: 4px 8px;
            font-family: monospace;
            font-size: 12px;
            cursor: pointer;
            margin-bottom: 4px;
          "
        />
        <div id="fps-measurement-progress" style="color: #aaaaaa; font-size: 11px; display: none;">
          Progress: --
        </div>
        <div id="fps-measurement-current" style="color: #aaaaaa; font-size: 11px; display: none;">
          Current: Decode --fps, Render --fps
        </div>
        <div id="fps-measurement-result" style="color: #00ff00; font-size: 12px; margin-top: 4px; display: none;">
          <!-- 측정 결과가 여기에 표시됩니다 -->
        </div>
        <input 
          type="button" 
          id="fps-result-download" 
          value="Download Results" 
          style="
            background: #333;
            color: #00ff00;
            border: 1px solid #555;
            padding: 4px 8px;
            font-family: monospace;
            font-size: 12px;
            cursor: pointer;
            margin-top: 4px;
            display: none;
          "
        />
      </div>

      <!-- 화면 녹화 기능 섹션 -->
      <div id="recording-section" style="margin-top: 8px; padding-top: 8px; border-top: 1px solid #333">
        <div style="color: #ffff00; font-weight: bold; margin-bottom: 4px">Screen Recording</div>
        <input 
          type="button" 
          id="recording-button" 
          value="Start Recording" 
          style="
            background: #333;
            color: #00ff00;
            border: 1px solid #555;
            padding: 4px 8px;
            font-family: monospace;
            font-size: 12px;
            cursor: pointer;
            margin-bottom: 4px;
          "
        />
        <div id="recording-status" style="color: #aaaaaa; font-size: 11px; display: none;">
          Status: --
        </div>
        <div id="recording-time" style="color: #aaaaaa; font-size: 11px; display: none;">
          Duration: --
        </div>
        <div id="recording-mode" style="color: #aaaaaa; font-size: 11px; display: none;">
          Mode: --
        </div>
        <div id="recording-size" style="color: #aaaaaa; font-size: 11px; display: none;">
          Size: --
        </div>
        <input 
          type="button" 
          id="recording-download" 
          value="Download Recording" 
          style="
            background: #333;
            color: #00ff00;
            border: 1px solid #555;
            padding: 4px 8px;
            font-family: monospace;
            font-size: 12px;
            cursor: pointer;
            margin-top: 4px;
            display: none;
          "
        />
        <div id="recording-compatibility" style="color: #ff6666; font-size: 11px; margin-top: 4px; display: none;">
          Recording not supported in this browser
        </div>
      </div>

      <!-- 키보드 단축키 안내 -->
      <div
        id="keyboard-shortcuts"
        style="
          margin-top: 8px;
          padding-top: 8px;
          border-top: 1px solid #333;
          font-size: 11px;
          color: #aaaaaa;
        "
      >
        <div style="margin-bottom: 2px">Shortcuts:</div>
        <div>H - Toggle UI</div>
        <div>ESC - Show UI</div>
        <div>Double-click - Toggle UI</div>
      </div>
    </div>
  </body>
</html>
